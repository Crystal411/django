$(function(){(function(e){function n(){var e=Baike.Tool.getUrlObj("vid"),n=e&&e.vid,r=t,i=0;if(n){for(var s=0;s<r.length;s++)if(r[s].id==decodeURIComponent(n)){i=s;break}new Baike.shortVideo($('.js-shortVideo-box[data-index="'+i+'"]'),{data:t,curIndex:i},"async")}}function r(){var e=$("#baike-content"),t=e.offset().top,n=$(".entry-box-shortVideo"),r=parseInt(n.css("margin-top").replace("px","")),i=$(".entry-card-content"),s=i.offset().top+i.height(),o=parseInt(i.css("margin-top").replace("px","")),u=$("#js-shortVideo-wrap"),a=u.offset().top+u.height(),f=parseInt(u.css("margin-top").replace("px",""));s>t&&($(".entry-box-shortVideo").animate({"margin-top":r+(s-t)+10}),$("#js-shortVideo-wrap").animate({"margin-top":f+(s-t)+10}));if(window.__REST_LINE&&parseInt(__REST_LINE)>4&&t-s>20){var l=r-(t-s)+20;n.css("margin-top",l);var c=t-(t-s)+20;a-c<20&&u.css("margin-top",f-(a-c)-20)}}Baike.Log.sendShowLog(["entry-shortvideo-show"]);var t=e.data("datalist");$.each(t,function(e,t){Baike.Log.sendShowLog(["entry-shortvideo-show-"+Baike.Info.sid+"-"+t.id])}),$.browser.msie&&$.browser.version<=8&&(e.on("mouseenter",".js-shortVideo-box",function(){var e=$.single(this),t=e.index();e.siblings().removeClass("on"),e.addClass("on").css({zIndex:3,top:0}),e.find(".title").css({bottom:0}),t==1?(e.siblings().css({top:22,zIndex:1}),e.siblings().find(".title").css({bottom:22})):t==0?e.siblings().each(function(e,t){var n=$.single(this),r=n.data("zindex"),i=n.data("anim");n.css({zIndex:r,top:i}),n.find(".title").css({bottom:i})}):t==2&&e.siblings().each(function(e,t){var n=$.single(this),r=0,i=11;e==0?(r=1,i=22):(r=2,i=11),n.css({zIndex:r,top:i}),n.find(".title").css({bottom:i})})}),e.find(".js-shortVideo-box").shortVideoDialog({data:t})),n(),$.browser.msie&&$.browser.version<=8||FWDS3DCovUtils.onReady(function(){var e={width:280,height:160};t.length==1&&(e={width:340,height:54400/280});var n=new FWDSimple3DCoverflow({coverflowHolderDivId:"js-shortVideo-wrap",coverflowDataListDivId:"coverflow",displayType:"fixed",autoScale:"false",coverflowWidth:420,coverflowHeight:160,skinPath:"/resource/img/load/skin_white",backgroundColor:"inherit",backgroundImagePath:"",backgroundRepeat:"repeat-x",showDisplay2DAlways:"yes",coverflowStartPosition:"left",coverflowTopology:"dualsided",coverflowXRotation:0,coverflowYRotation:0,numberOfThumbnailsToDisplayLeftAndRight:"all",infiniteLoop:"no",thumbnailWidth:e.width,thumbnailHeight:e.height,thumbnailXOffset3D:20,thumbnailXSpace3D:105,thumbnailZOffset3D:400,thumbnailZSpace3D:130,thumbnailYAngle3D:0,thumbnailXOffset2D:10,thumbnailXSpace2D:30,thumbnailHoverOffset:100,thumbnailBorderSize:0,thumbnailBackgroundColor:"#999999",thumbnailBorderColor1:"#FFFFFF",thumbnailBorderColor2:"#FFFFFF",transparentImages:"no",thumbnailsAlignment:"bottom",maxNumberOfThumbnailsOnMobile:13,showThumbnailsGradient:"no",thumbnailGradientColor1:"rgba(255, 255, 255, .4)",thumbnailGradientColor2:"rgba(255, 255, 255, 1)",showText:"yes",textOffset:10,showThumbnailBoxShadow:"no",thumbnailBoxShadowCss:"0px 2px 2px #BBBBBB",showTooltip:"no",dynamicTooltip:"no",reflectionHeight:60,reflectionDistance:0,reflectionOpacity:.2,slideshowDelay:3e3,autoplay:"no",disableNextAndPrevButtonsOnMobile:"no",controlsMaxWidth:700,slideshowTimerColor:"#FFFFFF",controlsPosition:"bottom",controlsOffset:15,showPrevButton:"no",showNextButton:"no",showSlideshowButton:"no",showScrollbar:"no",disableScrollbarOnMobile:"yes",enableMouseWheelScroll:"no",scrollbarHandlerWidth:200,scrollbarTextColorNormal:"#000000",scrollbarTextColorSelected:"#FFFFFF",addKeyboardSupport:"no",showCategoriesMenu:"yes",startAtCategory:1,categoriesMenuMaxWidth:700,categoriesMenuOffset:25,categoryColorNormal:"#999999",categoryColorSelected:"#000000",addLightBoxKeyboardSupport:"yes",showLightBoxNextAndPrevButtons:"yes",showLightBoxZoomButton:"yes",showLightBoxInfoButton:"yes",showLighBoxSlideShowButton:"yes",showLightBoxInfoWindowByDefault:"no",slideShowAutoPlay:"no",lightBoxVideoAutoPlay:"no",lightBoxVideoWidth:640,lightBoxVideoHeight:480,lightBoxIframeWidth:800,lightBoxIframeHeight:600,lightBoxBackgroundColor:"#000000",lightBoxInfoWindowBackgroundColor:"#FFFFFF",lightBoxItemBorderColor1:"#fcfdfd",lightBoxItemBorderColor2:"#e4FFe4",lightBoxItemBackgroundColor:"#333333",lightBoxMainBackgroundOpacity:.8,lightBoxInfoWindowBackgroundOpacity:.9,lightBoxBorderSize:0,lightBoxBorderRadius:0,lightBoxSlideShowDelay:4e3,onClickEnd:function(e){new Baike.shortVideo($('.js-shortVideo-box[data-index="'+e+'"]'),{data:t},"async")}})}),r()})($(".js-shortVideo-wrap"))}),function(e){function r(n,r,i){r=e.extend(!0,t,r),this.wrap=null,this.mask=null,this.el=n,this.cfg=r,this.type=i,this._init()}function i(){if(!e(".video-r").is(":hidden")){e('.js-videoDialog-play-list [data-index="0"]').after('<li class="js-imgad-video"></li>');var t=new MediavAds({$dom:e(".js-imgad-video"),itemWrap:".js-imgad-video",params:{showid:"sqcQkl",queryword:$INFO.ename,impct:1},successCallback:function(t){e(".js-imgad-video").html(e("#js-adimg-shortVideo-template").tmpl(t))},errorCallback:function(t){e(".js-imgad-video").hide()},noDataCallback:function(){e(".js-imgad-video").hide()}})}}var t={curIndex:0},n=function(t,n){return n=e.extend(n||{},{dataType:"script",cache:!0,url:t}),e.ajax(n)};e.net.jsonp("videoPath","/videoList/getVideoPath?callback=?"),e.net.jsonp("adApiVideoInner",Baike.Tool.switchProtocol("http://e.so.com/baike/ads")),e.fn.shortVideoDialog=function(n){return this.each(function(i,s){e.extend(!0,t,n),new r(e(s),t)})},r.prototype={_init:function(t){var n=this,r=this.el.data("index")||0;n.cfg.curIndex==undefined&&e.extend(!0,n.cfg,{curIndex:r}),this.type!="async"?this.el.on("click",function(){var t=e.single(this);e.extend(!0,n.cfg,{curIndex:t.data("index")}),n._showDialog(t.data("index"))}):n._showDialog(this.el.data("index"))},_showDialog:function(e){var t=this;t._loadTmpl(),e=e||0,t.cfg.data[e].sendLog!==!1&&(Baike.Log.send("shortvideo-play"),Baike.Log.send({c:"shortvideo-play-"+(t.cfg.data[e].sid||Baike.Info.sid)+"-"+t.cfg.data[e].id,eid:t.cfg.data[e].eid||Baike.Info.eid,sid:t.cfg.data[e].sid||Baike.Info.sid,vid:t.cfg.data[e].id}))},_loadTmpl:function(){var t=this,r;window.ActiveXObject||"ActiveXObject"in window?r="https://s0.ssl.qhimg.com/static/a2f6df3315ab39c7.js":r="https://s1.ssl.qhimg.com/static/25db2026aa1019bd.js",n(Baike.Tool.switchProtocol(r)).done(function(){e.getTmpl("/resource/other/template/entry_shortVideo.html?random="+ +(new Date)).done(function(){var n=e("#js-t-shortVideo").tmpl(t.cfg);e("body").append(n),t.getVideoPath(),t._evt(),t.closeScroll(!0)})})},getVideoPath:function(){var t=this,n={container:e(".js-doc-videoDialog"),sn:Baike.Tool.switchProtocol(t.cfg.data[t.cfg.curIndex].stream_clarity.m3u8_cq||t.cfg.data[t.cfg.curIndex].sn||t.cfg.data[t.cfg.curIndex].mp4),coverImg:t.cfg.data[t.cfg.curIndex].image,clarity:[],play:!0};t.cfg.data[t.cfg.curIndex].source_type&&t.cfg.data[t.cfg.curIndex].source_type==2?e.net.connect("videoPath",{"360kan_vid":t.cfg.data[t.cfg.curIndex].stream_clarity.m3u8},function(e){e.errno==0&&(e.data.d_360p&&e.data.d_360p.cdn_url&&(n.sn=Baike.Tool.switchProtocol(e.data.d_360p.cdn_url),n.clarity.push({name:"\u6807\u6e05",src:Baike.Tool.switchProtocol(e.data.d_360p.cdn_url)})),e.data.d_480p&&e.data.d_480p.cdn_url&&(n.sn==""&&(n.sn=Baike.Tool.switchProtocol(e.data.d_480p.cdn_url)),n.clarity.push({name:"\u9ad8\u6e05",src:Baike.Tool.switchProtocol(e.data.d_480p.cdn_url)})),e.data.d_720p&&e.data.d_720p.cdn_url&&(n.sn=Baike.Tool.switchProtocol(e.data.d_720p.cdn_url),n.clarity.push({name:"\u8d85\u6e05",src:Baike.Tool.switchProtocol(e.data.d_720p.cdn_url)})),e.data.d_raw&&e.data.d_raw.cdn_url&&(n.sn==""&&(n.sn=Baike.Tool.switchProtocol(e.data.d_raw.cdn_url)),n.clarity.push({name:"\u8d85\u6e05",src:Baike.Tool.switchProtocol(e.data.d_raw.cdn_url)})),setTimeout(function(){new so_video(n)},0))}):(t.cfg.data[t.cfg.curIndex].stream_clarity.m3u8&&n.clarity.push({name:"\u6807\u6e05",src:Baike.Tool.switchProtocol(t.cfg.data[t.cfg.curIndex].stream_clarity.m3u8)}),t.cfg.data[t.cfg.curIndex].stream_clarity.m3u8_gq&&n.clarity.push({name:"\u9ad8\u6e05",src:Baike.Tool.switchProtocol(t.cfg.data[t.cfg.curIndex].stream_clarity.m3u8_gq)}),t.cfg.data[t.cfg.curIndex].stream_clarity.m3u8_cq&&n.clarity.push({name:"\u8d85\u6e05",src:Baike.Tool.switchProtocol(t.cfg.data[t.cfg.curIndex].stream_clarity.m3u8_cq)}),t.cfg.data[t.cfg.curIndex].stream_clarity.m3u8_yh&&n.clarity.push({name:"\u539f\u753b",src:Baike.Tool.switchProtocol(t.cfg.data[t.cfg.curIndex].stream_clarity.m3u8_yh)}),setTimeout(function(){new so_video(n)},0))},playNext:function(t){var n=this,r=t.data("index");n.cfg.curIndex=r,n.getVideoPath(),n.cfg.data[r].title.length<40?e(".js-title",n.wrap).html(n.cfg.data[r].title).removeClass("short"):e(".js-title",n.wrap).html(n.cfg.data[r].title).addClass("short"),e(".js-foot",n.wrap).html(n.cfg.data[r].source_title).attr("title",n.cfg.data[r].source_title).attr("href",n.cfg.data[r].source_url),n.cfg.data[r].sendLog!==!1&&(Baike.Log.send("shortvideo-play"),Baike.Log.send({c:"shortvideo-play-"+(n.cfg.data[r].sid||Baike.Info.sid)+"-"+n.cfg.data[r].id,eid:n.cfg.data[r].eid||Baike.Info.eid,sid:n.cfg.data[r].sid||Baike.Info.sid,vid:n.cfg.data[r].id}))},close:function(){this.wrap.fadeOut().remove(),this.mask.fadeOut().remove(),this.closeScroll(!1)},closeScroll:function(t){t?e("body").addClass("close-scroll"):e("body").removeClass("close-scroll")},_evt:function(){this.wrap=e(".js-shortVideo-dialog"),this.mask=e(".js-shortVideo-dialog-mask");var t=this,n=e(".js-close",t.wrap),r=e(".js-share",t.wrap),i=e(".js-videoDialog-play-list",t.wrap),s=t.cfg.curIndex;n.on("click",function(){t.close()}),i.on("click","li:not(.on)",function(){var n=e.single(this);n.attr("data-index")&&(n.siblings().removeClass("on"),n.addClass("on"),t.playNext(e(this)))});var o=e(".js-shortVideo-share-box");o.delegate("a","click",function(n){n.preventDefault(),t._share(e(this))}),r.on("mouseleave",function(){e(".js-weixinqrcode").hide()})},_share:function(t){var r=t,i=this,s=i.cfg.data[i.cfg.curIndex],o="\u6765360\u767e\u79d1\u770b\u300a"+s.title+"\u300b,\u8f7b\u677e\u4e86\u89e3"+Baike.Info.ename+"!",u="\u6765360\u767e\u79d1\u770b\u300a"+s.title+"\u300b,\u8f7b\u677e\u4e86\u89e3"+Baike.Info.ename+"!",a=location.href,f=s.image;a=a.replace(/[\?&]vid=[\d]+/ig,"").replace(/(\?.*?)?(#|$)/,function(e,t,n){var r="";return t&&t.indexOf("?")>-1?r=t.toString()+"&vid="+s.id:r="?vid="+s.id,n&&(r+=n),r});var l={s_title:encodeURIComponent(o),s_content:encodeURIComponent(u),s_link:encodeURIComponent(a),s_pic:encodeURIComponent(f)},c=r.find("i").attr("class"),h="http://service.t.sina.com.cn/share/share.php?appkey=1495952907&title="+l.s_content+"&pic="+l.s_pic+"&url="+l.s_link,p="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+l.s_link+"&title="+l.s_title+"&summary="+l.s_content+"&pics="+l.s_pic,d="http://widget.renren.com/dialog/share?resourceUrl="+l.s_link+"&title="+l.s_title+"&description="+l.s_content+"&images="+l.s_pic,v="http://share.v.t.qq.com/index.php?c=share&a=index&url="+l.s_link+"&title="+l.s_content+"&pic="+l.s_pic,m="http://shuo.douban.com/!service/share?href="+l.s_link+"&name="+l.s_content,g="http://tieba.baidu.com/f/commit/share/openShareApi?url="+l.s_link+"&title="+l.s_title,y="http://connect.qq.com/widget/shareqq/index.html?url="+l.s_link+"&title="+l.s_title+"&summary="+l.s_content+"&pics="+l.s_pic,b={weibo:h,qzone:p,renren:d,tweibo:v,douban:m,tieba:g,qq:y,url:""};b.url=c=="weibo"?b.weibo:c=="qzone"?b.qzone:c=="renren"?b.renren:c=="tweibo"?b.tweibo:c=="douban"?b.douban:c=="tieba"?b.tieba:c=="qq"?b.qq:"";var w=e(".js-weixinqrcode");return Baike.Log.send("shortvideo-share-"+c),c=="weixin"?w.attr("data-make")!="1"?n(Baike.Tool.switchProtocol("https://s.ssl.qhres.com/ssl/b83214d4cde2180c.js")).done(function(){w.show();var e={width:80,height:80,colorDark:"#000000"},t=new QRCode(w[0],e);t.makeCode(location.href.replace("https","http").replace(/(dry|test)?\.?baike\.so\.com.*/ig,"m.baike."+Baike.Info.host+"/video?eid="+Baike.Info.eid+"&sid="+Baike.Info.sid+"&vid="+s.id)),w.attr("data-make",1)}):w.show():b.url&&window.open(b.url),!1}},e.namespace("Baike.shortVideo"),Baike.shortVideo=r}(jQuery);